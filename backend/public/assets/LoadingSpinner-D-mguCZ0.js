import{k as c,q as T,c as d,d as U,a as b,F,r as O,b as m,t as V,x as $,u as B,o as p}from"./index-DncRbb0O.js";const R="/analytics/api/stats";function I(){const a=new URLSearchParams(window.location.search).get("token");return a?(localStorage.setItem("analytics_token",a),a):localStorage.getItem("analytics_token")||""}async function g(e,a={}){const n=I(),o=new URL(`${R}${e}`,window.location.origin);Object.entries(a).forEach(([s,r])=>{r&&o.searchParams.set(s,r)});const l=await fetch(o.toString(),{headers:{Authorization:`Bearer ${n}`}});if(!l.ok)throw l.status===401?new Error("Nicht autorisiert. Bitte Token prüfen."):new Error(`API Error: ${l.status}`);const i=await l.text();if(!i||i.trim()==="")throw new Error("Leere Antwort vom Server erhalten.");try{return JSON.parse(i)}catch{throw new Error("Ungültige JSON-Antwort vom Server.")}}function N(){const e=c(!1),a=c(null);async function n(r="30d"){e.value=!0,a.value=null;try{return await g("/overview",{period:r})}catch(u){return a.value=u instanceof Error?u.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function o(r="30d",u){e.value=!0,a.value=null;try{return await g("/daily",{period:r,page:u||""})}catch(v){return a.value=v instanceof Error?v.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function l(){e.value=!0,a.value=null;try{return await g("/hourly")}catch(r){return a.value=r instanceof Error?r.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function i(r="30d",u){e.value=!0,a.value=null;try{return await g("/regions",{period:r,page:u||""})}catch(v){return a.value=v instanceof Error?v.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function s(){e.value=!0,a.value=null;try{return await g("/live")}catch(r){return a.value=r instanceof Error?r.message:"Unbekannter Fehler",null}finally{e.value=!1}}return{loading:e,error:a,getOverview:n,getDaily:o,getHourly:l,getRegions:i,getLive:s}}const J=T("analytics",()=>{const e=N(),a=c(null),n=c(null),o=c(null),l=c(null),i=c("30d"),s=c(""),r=c(!1),u=c(null),v=d(()=>{var t;return((t=a.value)==null?void 0:t.summary.totalViews)??0}),P=d(()=>{var t;return((t=a.value)==null?void 0:t.summary.allTimeViews)??0}),x=d(()=>{var t;return((t=a.value)==null?void 0:t.summary.last24hViews)??0}),E=d(()=>{var t;return((t=a.value)==null?void 0:t.pages)??[]}),A=d(()=>{var t;return(t=n.value)!=null&&t.data.length?{labels:n.value.data.map(f=>new Date(f.date).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})),datasets:[{label:"Aufrufe",data:n.value.data.map(f=>f.views),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.3}]}:null}),L=d(()=>{var f;if(!((f=o.value)!=null&&f.regions.length))return null;const t=o.value.regions.slice(0,10);return{labels:t.map(y=>y.name),datasets:[{label:"Aufrufe",data:t.map(y=>y.views),backgroundColor:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"]}]}});async function _(){r.value=!0,u.value=null;try{a.value=await e.getOverview(i.value),e.error.value&&(u.value=e.error.value)}finally{r.value=!1}}async function h(){n.value=await e.getDaily(i.value,s.value||void 0),e.error.value&&(u.value=e.error.value)}async function w(){o.value=await e.getRegions(i.value,s.value||void 0),e.error.value&&(u.value=e.error.value)}async function k(){l.value=await e.getLive(),e.error.value&&(u.value=e.error.value)}async function S(){await Promise.all([_(),h(),w(),k()])}function D(t){i.value=t,S()}function C(t){s.value=t,h(),w()}return{overview:a,daily:n,regions:o,live:l,selectedPeriod:i,selectedPage:s,isLoading:r,error:u,totalViews:v,allTimeViews:P,last24hViews:x,pageStats:E,chartData:A,regionChartData:L,fetchOverview:_,fetchDaily:h,fetchRegions:w,fetchLive:k,fetchAll:S,setPeriod:D,setPage:C}}),j={class:"flex items-center gap-1 bg-gray-100 p-1 rounded-lg"},z=["onClick"],Q=U({__name:"PeriodSelector",setup(e){const a=J(),n=[{value:"7d",label:"7 Tage"},{value:"30d",label:"30 Tage"},{value:"90d",label:"90 Tage"},{value:"year",label:"1 Jahr"},{value:"all",label:"Alle"}];function o(l){a.setPeriod(l)}return(l,i)=>(p(),b("div",j,[(p(),b(F,null,O(n,s=>m("button",{key:s.value,class:$(["px-3 py-1.5 text-sm font-medium rounded-md transition-colors",B(a).selectedPeriod===s.value?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"]),onClick:r=>o(s.value)},V(s.label),11,z)),64))]))}}),q=(e,a)=>{const n=e.__vccOpts||e;for(const[o,l]of a)n[o]=l;return n},H={},G={class:"flex items-center justify-center py-12"};function K(e,a){return p(),b("div",G,[...a[0]||(a[0]=[m("div",{class:"relative"},[m("div",{class:"w-12 h-12 rounded-full border-4 border-gray-200"}),m("div",{class:"w-12 h-12 rounded-full border-4 border-primary-500 border-t-transparent animate-spin absolute top-0 left-0"})],-1)])])}const W=q(H,[["render",K]]);export{W as L,Q as _,J as u};
