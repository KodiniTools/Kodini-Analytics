import{k as c,q as D,c as g,d as R,a as p,F as T,r as F,b as m,t as U,x as O,u as V,o as b}from"./index-D3YILK1Z.js";const $="/analytics/api/stats";function B(){const t=new URLSearchParams(window.location.search).get("token");return t?(localStorage.setItem("analytics_token",t),t):localStorage.getItem("analytics_token")||""}async function d(e,t={}){const l=B(),o=new URL(`${$}${e}`,window.location.origin);Object.entries(t).forEach(([u,n])=>{n&&o.searchParams.set(u,n)}),console.log("[API] Fetching:",o.toString()),console.log("[API] Token:",l?"present":"missing");const r=await fetch(o.toString(),{headers:{Authorization:`Bearer ${l}`}});if(console.log("[API] Response status:",r.status),!r.ok)throw r.status===401?new Error("Nicht autorisiert. Bitte Token prüfen."):new Error(`API Error: ${r.status}`);if(r.status===204)return console.log("[API] 204 No Content - returning null"),null;const s=await r.text();if(console.log("[API] Response text length:",s.length),console.log("[API] Response text:",s.substring(0,200)),!s||s.trim()==="")return console.log("[API] Empty response body - returning null"),null;try{return JSON.parse(s)}catch{throw new Error("Ungültige JSON-Antwort vom Server.")}}function N(){const e=c(!1),t=c(null);async function l(n="30d"){e.value=!0,t.value=null;try{return await d("/overview",{period:n})}catch(i){return t.value=i instanceof Error?i.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function o(n="30d",i){e.value=!0,t.value=null;try{return await d("/daily",{period:n,page:i||""})}catch(v){return t.value=v instanceof Error?v.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function r(){e.value=!0,t.value=null;try{return await d("/hourly")}catch(n){return t.value=n instanceof Error?n.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function s(n="30d",i){e.value=!0,t.value=null;try{return await d("/regions",{period:n,page:i||""})}catch(v){return t.value=v instanceof Error?v.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function u(){e.value=!0,t.value=null;try{return await d("/live")}catch(n){return t.value=n instanceof Error?n.message:"Unbekannter Fehler",null}finally{e.value=!1}}return{loading:e,error:t,getOverview:l,getDaily:o,getHourly:r,getRegions:s,getLive:u}}const J=D("analytics",()=>{const e=N(),t=c(null),l=c(null),o=c(null),r=c(null),s=c("30d"),u=c(""),n=c(!1),i=c(null),v=g(()=>{var a;return((a=t.value)==null?void 0:a.summary.totalViews)??0}),A=g(()=>{var a;return((a=t.value)==null?void 0:a.summary.allTimeViews)??0}),x=g(()=>{var a;return((a=t.value)==null?void 0:a.summary.last24hViews)??0}),S=g(()=>{var a;return((a=t.value)==null?void 0:a.pages)??[]}),E=g(()=>{var a;return(a=l.value)!=null&&a.data.length?{labels:l.value.data.map(f=>new Date(f.date).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})),datasets:[{label:"Aufrufe",data:l.value.data.map(f=>f.views),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.3}]}:null}),I=g(()=>{var f;if(!((f=o.value)!=null&&f.regions.length))return null;const a=o.value.regions.slice(0,10);return{labels:a.map(y=>y.name),datasets:[{label:"Aufrufe",data:a.map(y=>y.views),backgroundColor:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"]}]}});async function _(){n.value=!0,i.value=null;try{t.value=await e.getOverview(s.value),e.error.value&&(i.value=e.error.value)}finally{n.value=!1}}async function h(){l.value=await e.getDaily(s.value,u.value||void 0),e.error.value&&(i.value=e.error.value)}async function w(){o.value=await e.getRegions(s.value,u.value||void 0),e.error.value&&(i.value=e.error.value)}async function k(){r.value=await e.getLive(),e.error.value&&(i.value=e.error.value)}async function P(){await Promise.all([_(),h(),w(),k()])}function L(a){s.value=a,P()}function C(a){u.value=a,h(),w()}return{overview:t,daily:l,regions:o,live:r,selectedPeriod:s,selectedPage:u,isLoading:n,error:i,totalViews:v,allTimeViews:A,last24hViews:x,pageStats:S,chartData:E,regionChartData:I,fetchOverview:_,fetchDaily:h,fetchRegions:w,fetchLive:k,fetchAll:P,setPeriod:L,setPage:C}}),j={class:"flex items-center gap-1 bg-gray-100 p-1 rounded-lg"},z=["onClick"],Q=R({__name:"PeriodSelector",setup(e){const t=J(),l=[{value:"7d",label:"7 Tage"},{value:"30d",label:"30 Tage"},{value:"90d",label:"90 Tage"},{value:"year",label:"1 Jahr"},{value:"all",label:"Alle"}];function o(r){t.setPeriod(r)}return(r,s)=>(b(),p("div",j,[(b(),p(T,null,F(l,u=>m("button",{key:u.value,class:O(["px-3 py-1.5 text-sm font-medium rounded-md transition-colors",V(t).selectedPeriod===u.value?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"]),onClick:n=>o(u.value)},U(u.label),11,z)),64))]))}}),q=(e,t)=>{const l=e.__vccOpts||e;for(const[o,r]of t)l[o]=r;return l},H={},G={class:"flex items-center justify-center py-12"};function K(e,t){return b(),p("div",G,[...t[0]||(t[0]=[m("div",{class:"relative"},[m("div",{class:"w-12 h-12 rounded-full border-4 border-gray-200"}),m("div",{class:"w-12 h-12 rounded-full border-4 border-primary-500 border-t-transparent animate-spin absolute top-0 left-0"})],-1)])])}const W=q(H,[["render",K]]);export{W as L,Q as _,J as u};
