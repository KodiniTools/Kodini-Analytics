import{k as c,q as R,c as g,d as T,a as p,F as C,r as F,b as h,t as U,x as O,u as V,o as b}from"./index-DSakaot9.js";const $="/analytics/api/stats";function B(){const t=new URLSearchParams(window.location.search).get("token");return t?(localStorage.setItem("analytics_token",t),t):localStorage.getItem("analytics_token")||""}async function d(e,t={}){const n=B(),o=new URL(`${$}${e}`,window.location.origin);Object.entries(t).forEach(([u,r])=>{r&&o.searchParams.set(u,r)}),console.log("[API] Fetching:",o.toString()),console.log("[API] Token:",n?"present":"missing");const l=await fetch(o.toString(),{headers:{Authorization:`Bearer ${n}`}});if(console.log("[API] Response status:",l.status),!l.ok)throw l.status===401?new Error("Nicht autorisiert. Bitte Token prüfen."):new Error(`API Error: ${l.status}`);const s=await l.text();if(console.log("[API] Response text length:",s.length),console.log("[API] Response text:",s.substring(0,200)),!s||s.trim()==="")throw new Error("Leere Antwort vom Server erhalten.");try{return JSON.parse(s)}catch{throw new Error("Ungültige JSON-Antwort vom Server.")}}function N(){const e=c(!1),t=c(null);async function n(r="30d"){e.value=!0,t.value=null;try{return await d("/overview",{period:r})}catch(i){return t.value=i instanceof Error?i.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function o(r="30d",i){e.value=!0,t.value=null;try{return await d("/daily",{period:r,page:i||""})}catch(v){return t.value=v instanceof Error?v.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function l(){e.value=!0,t.value=null;try{return await d("/hourly")}catch(r){return t.value=r instanceof Error?r.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function s(r="30d",i){e.value=!0,t.value=null;try{return await d("/regions",{period:r,page:i||""})}catch(v){return t.value=v instanceof Error?v.message:"Unbekannter Fehler",null}finally{e.value=!1}}async function u(){e.value=!0,t.value=null;try{return await d("/live")}catch(r){return t.value=r instanceof Error?r.message:"Unbekannter Fehler",null}finally{e.value=!1}}return{loading:e,error:t,getOverview:n,getDaily:o,getHourly:l,getRegions:s,getLive:u}}const J=R("analytics",()=>{const e=N(),t=c(null),n=c(null),o=c(null),l=c(null),s=c("30d"),u=c(""),r=c(!1),i=c(null),v=g(()=>{var a;return((a=t.value)==null?void 0:a.summary.totalViews)??0}),A=g(()=>{var a;return((a=t.value)==null?void 0:a.summary.allTimeViews)??0}),S=g(()=>{var a;return((a=t.value)==null?void 0:a.summary.last24hViews)??0}),x=g(()=>{var a;return((a=t.value)==null?void 0:a.pages)??[]}),E=g(()=>{var a;return(a=n.value)!=null&&a.data.length?{labels:n.value.data.map(f=>new Date(f.date).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})),datasets:[{label:"Aufrufe",data:n.value.data.map(f=>f.views),borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.3}]}:null}),L=g(()=>{var f;if(!((f=o.value)!=null&&f.regions.length))return null;const a=o.value.regions.slice(0,10);return{labels:a.map(y=>y.name),datasets:[{label:"Aufrufe",data:a.map(y=>y.views),backgroundColor:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"]}]}});async function _(){r.value=!0,i.value=null;try{t.value=await e.getOverview(s.value),e.error.value&&(i.value=e.error.value)}finally{r.value=!1}}async function m(){n.value=await e.getDaily(s.value,u.value||void 0),e.error.value&&(i.value=e.error.value)}async function w(){o.value=await e.getRegions(s.value,u.value||void 0),e.error.value&&(i.value=e.error.value)}async function k(){l.value=await e.getLive(),e.error.value&&(i.value=e.error.value)}async function P(){await Promise.all([_(),m(),w(),k()])}function D(a){s.value=a,P()}function I(a){u.value=a,m(),w()}return{overview:t,daily:n,regions:o,live:l,selectedPeriod:s,selectedPage:u,isLoading:r,error:i,totalViews:v,allTimeViews:A,last24hViews:S,pageStats:x,chartData:E,regionChartData:L,fetchOverview:_,fetchDaily:m,fetchRegions:w,fetchLive:k,fetchAll:P,setPeriod:D,setPage:I}}),j={class:"flex items-center gap-1 bg-gray-100 p-1 rounded-lg"},z=["onClick"],Q=T({__name:"PeriodSelector",setup(e){const t=J(),n=[{value:"7d",label:"7 Tage"},{value:"30d",label:"30 Tage"},{value:"90d",label:"90 Tage"},{value:"year",label:"1 Jahr"},{value:"all",label:"Alle"}];function o(l){t.setPeriod(l)}return(l,s)=>(b(),p("div",j,[(b(),p(C,null,F(n,u=>h("button",{key:u.value,class:O(["px-3 py-1.5 text-sm font-medium rounded-md transition-colors",V(t).selectedPeriod===u.value?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"]),onClick:r=>o(u.value)},U(u.label),11,z)),64))]))}}),q=(e,t)=>{const n=e.__vccOpts||e;for(const[o,l]of t)n[o]=l;return n},H={},G={class:"flex items-center justify-center py-12"};function K(e,t){return b(),p("div",G,[...t[0]||(t[0]=[h("div",{class:"relative"},[h("div",{class:"w-12 h-12 rounded-full border-4 border-gray-200"}),h("div",{class:"w-12 h-12 rounded-full border-4 border-primary-500 border-t-transparent animate-spin absolute top-0 left-0"})],-1)])])}const W=q(H,[["render",K]]);export{W as L,Q as _,J as u};
